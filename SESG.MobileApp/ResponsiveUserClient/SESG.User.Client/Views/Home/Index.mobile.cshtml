@section scripts {
<script type="text/javascript" src="~/Scripts/sesg.users.client.js">
</script>

<script type="text/javascript" src="~/Scripts/sesg.users.pager.js">
</script>

<script type="text/javascript">
    var pager = null;
    var sesg_users_client = null;
    var apiUrl = 'http://jerome7/SESG.UserWebService';

    $(document).ready(function () {
        sesg_user_client = new SesgUserClient(apiUrl);
        pager = new SesgUserPager(sesg_user_client, gotUsers, getUsersError);
        
        $(".fetchNextUsersBtn").click(function () {
            showSpinner();
            pager.next();
        });
        $(".fetchPreviousUsersBtn").click(function () {
            showSpinner();
            pager.previous();
        });
        
        $(".fetchPreviousUsersBtn").parent().hide();
        showSpinner();
        pager.fetch();
        
    });

    function showSpinner() {
        $.mobile.showPageLoadingMsg();
    }

    function hideSpinner() {
        $.mobile.hidePageLoadingMsg();
    }

    function gotUsers(data) {
        $ul = $("#usersList");
        $ul.empty();

        if (pager.index > 0) {
            $(".fetchPreviousUsersBtn").parent().show();
        }
        else {
            $(".fetchPreviousUsersBtn").parent().hide();
        }

        $.each(data, function (index, value) {
            var id = this.id;
            var userName = this.username;
            var company = this.company;
            var avatar = this.avatar;

            $li = $("<li data-role='option' data-theme='c'  />");
            $p = $("<p/>").text(userName);
            $li.append($p);
            $img = $("<img/>")
                    .attr('src', avatar)
                    .attr('width', '100px');
            $li.append($img);
            
            $ul.append($li);
        })

        $ul.listview('refresh');
        hideSpinner();
    }

    function getUsersError(sender, xhr, status, error) {
        hideSpinner();
        alert(error);
    }
</script>
}

<div id="body">
    <div style="padding: 10px;">
        <input type="submit" value="Previous" class="fetchPreviousUsersBtn" data-inline="true" />
        <input type="submit" value="Next" class="fetchNextUsersBtn" data-inline="true" />
    </div>
    <div id="results" style="padding: 10px;">
        <ul data-role="listview" id="usersList" data-autodividers="true">

        </ul>
    </div>
    <div style="padding: 10px;">
        <input type="submit" value="Previous" class="fetchPreviousUsersBtn" data-inline="true" />
        <input type="submit" value="Next" class="fetchNextUsersBtn" data-inline="true" />
    </div>
</div>
